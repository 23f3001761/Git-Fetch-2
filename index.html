<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>GitHub User - Creation Date and Account Age</title>
  <!-- Bootstrap CSS (latest stable via jsDelivr) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    /* Small layout tweak for better presentation on small screens */
    #github-created-at, #github-account-age {
      min-height: 1.25em;
    }
  </style>
</head>
<body>
  <div class="container py-4">
    <h1 class="h4 mb-3">GitHub User - Creation Date and Account Age</h1>

    <form id="github-user-100" class="row g-3 align-items-center mb-3" autocomplete="off" aria-label="GitHub user form">
      <div class="col-auto">
        <label class="visually-hidden" for="github-username">GitHub username</label>
        <input type="text" id="github-username" class="form-control" placeholder="GitHub username" required/>
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-primary">Fetch</button>
      </div>
      <div class="col-12">
        <small id="status" class="form-text text-muted">Enter a GitHub username. Optionally, provide ?token= in the page URL to use a personal access token for higher rate limits.</small>
      </div>
    </form>

    <div class="card border-0 bg-light p-3">
      <div class="d-flex flex-column">
        <div id="github-created-at" class="mb-1"></div>
        <div id="github-account-age" class="mb-1"></div>
        <div id="github-error" class="text-danger" role="alert" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (latest stable via jsDelivr) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (function(){
      const form = document.getElementById('github-user-100');
      const usernameInput = document.getElementById('github-username');
      const createdAtEl = document.getElementById('github-created-at');
      const ageEl = document.getElementById('github-account-age');
      const errorEl = document.getElementById('github-error');
      const token = new URLSearchParams(window.location.search).get('token');

      form.addEventListener('submit', async function(e){
        e.preventDefault();
        const username = (usernameInput.value || '').trim();
        if (!username) {
          errorEl.textContent = 'Please enter a GitHub username.';
          createdAtEl.textContent = '';
          ageEl.textContent = '';
          return;
        }
        errorEl.textContent = '';
        createdAtEl.textContent = 'Loading...';
        ageEl.textContent = '';

        try {
          const headers = {};
          if (token) headers['Authorization'] = 'token ' + token;
          const response = await fetch(`https://api.github.com/users/${encodeURIComponent(username)}`, { headers });
          if (!response.ok) {
            if (response.status === 404) {
              errorEl.textContent = 'User not found';
            } else if (response.status === 403) {
              errorEl.textContent = 'Access forbidden or rate limited. Try again later or provide a valid token.';
            } else {
              errorEl.textContent = `Error: ${response.status} ${response.statusText}`;
            }
            createdAtEl.textContent = '';
            ageEl.textContent = '';
            return;
          }
          const data = await response.json();
          const createdAt = data.created_at;
          const formattedDate = formatCreatedAt(createdAt);
          const ageYears = computeAge(createdAt);
          createdAtEl.textContent = formattedDate;
          ageEl.textContent = `Account age: ${ageYears} year${ageYears === 1 ? '' : 's'}`;
        } catch (err) {
          errorEl.textContent = 'Network error or invalid response';
          createdAtEl.textContent = '';
          ageEl.textContent = '';
        }
      });

      function formatCreatedAt(iso) {
        if (!iso) return '';
        const d = new Date(iso);
        const yyyy = d.getUTCFullYear();
        const mm = String(d.getUTCMonth() + 1).padStart(2, '0');
        const dd = String(d.getUTCDate()).padStart(2, '0');
        return `${yyyy}-${mm}-${dd} UTC`;
      }

      function computeAge(iso) {
        if (!iso) return 0;
        const birth = new Date(iso);
        const now = new Date();
        let age = now.getUTCFullYear() - birth.getUTCFullYear();
        const hasHadBirthdayThisYear = (now.getUTCMonth() > birth.getUTCMonth()) ||
          (now.getUTCMonth() === birth.getUTCMonth() && now.getUTCDate() >= birth.getUTCDate());
        if (!hasHadBirthdayThisYear) age--;
        if (age < 0) age = 0;
        return age;
      }
    })();
  </script>
</body>
</html>